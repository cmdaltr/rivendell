digraph JobStateMachine {
    rankdir=TB;

    // Graph styling
    graph [fontname="Arial", fontsize=12, bgcolor="#0f0f23", pad=0.5];
    node [fontname="Arial", fontsize=10, style=filled, shape=box, fillcolor="#2d2d44", fontcolor="#f0dba5", color="#3f4b2a"];
    edge [fontname="Arial", fontsize=9, color="#66d9ef", fontcolor="#a7db6c"];

    // States
    queued [label="QUEUED\n(Saved for Later)", shape=rect, fillcolor="#845ef7"];
    pending [label="PENDING\n(Ready to Start)", shape=rect, fillcolor="#4dabf7"];
    running [label="RUNNING\n(Executing)", shape=ellipse, fillcolor="#ffd43b"];
    completed [label="COMPLETED\n(Success)", shape=rect, fillcolor="#51cf66"];
    failed [label="FAILED\n(Error)", shape=rect, fillcolor="#ff6b6b"];
    cancelled [label="CANCELLED\n(User Stopped)", shape=rect, fillcolor="#fa5252"];
    archived [label="ARCHIVED\n(Historical)", shape=rect, fillcolor="#20c997"];

    // Transitions
    queued -> pending [label="Start Job", color="#4dabf7"];
    pending -> running [label="Celery Task\nDispatched", color="#ffd43b"];
    running -> completed [label="Success", color="#51cf66"];
    running -> failed [label="Error/Exception", color="#ff6b6b"];
    running -> cancelled [label="User Cancels", color="#fa5252"];

    // Archive transitions
    completed -> archived [label="Archive", color="#20c997"];
    failed -> archived [label="Archive", color="#20c997"];
    cancelled -> archived [label="Archive", color="#20c997"];

    // Restore transitions
    archived -> completed [label="Restore\n(was completed)", color="#51cf66", style=dashed];
    archived -> failed [label="Restore\n(was failed)", color="#ff6b6b", style=dashed];

    // Restart transitions
    failed -> pending [label="Restart", color="#4dabf7", style=dotted];
    cancelled -> pending [label="Restart", color="#4dabf7", style=dotted];
    completed -> pending [label="Re-run", color="#4dabf7", style=dotted];

    // Legend
    legend [shape=note, fillcolor="#1a1a2e", fontcolor="#f0dba5", label="STATE TRANSITIONS:\n━━━ Normal Flow\n┄┄┄ Restart/Re-run\n- - - Restore from Archive"];
}
