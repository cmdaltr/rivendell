# MITRE ATT&CK Configuration
# Version: 2.1.0

# ATT&CK Data Sources
sources:
  enterprise:
    url: "https://raw.githubusercontent.com/mitre/cti/master/enterprise-attack/enterprise-attack.json"
    fallback: "https://github.com/mitre-attack/attack-stix-data/raw/master/enterprise-attack/enterprise-attack.json"
    enabled: true

  mobile:
    url: "https://raw.githubusercontent.com/mitre/cti/master/mobile-attack/mobile-attack.json"
    fallback: "https://github.com/mitre-attack/attack-stix-data/raw/master/mobile-attack/mobile-attack.json"
    enabled: false

  ics:
    url: "https://raw.githubusercontent.com/mitre/cti/master/ics-attack/ics-attack.json"
    fallback: "https://github.com/mitre-attack/attack-stix-data/raw/master/ics-attack/ics-attack.json"
    enabled: false

# Cache Configuration
cache:
  directory: "/tmp/rivendell/mitre_cache"
  max_age_days: 7  # Auto-update if cache older than this
  auto_update: true
  compression: true  # Compress cached data

# Update Schedule
update:
  enabled: true
  interval_hours: 168  # Weekly (7 days)
  on_startup: true  # Check for updates on application startup
  retry_count: 3
  retry_delay_seconds: 60

# Technique Mapping Configuration
mapping:
  # Minimum confidence threshold for reporting techniques
  min_confidence: 0.5

  # Enable context-aware mapping (pattern matching)
  context_aware: true

  # Enable data-aware mapping (artifact content analysis)
  data_aware: true

  # Maximum number of techniques to report per artifact
  max_techniques_per_artifact: 10

  # Confidence thresholds for categorization
  confidence_thresholds:
    high: 0.8
    medium: 0.5
    low: 0.3

# Dashboard Configuration
dashboards:
  # Output directory for generated dashboards
  output_dir: "/tmp/rivendell/dashboards"

  # Formats to generate by default
  default_formats:
    - splunk
    - elastic
    - navigator

  # Splunk configuration
  splunk:
    enabled: true
    # If auto_deploy is enabled, dashboards will be pushed to Splunk
    auto_deploy: false
    hec_url: "https://splunk.example.com:8088"
    hec_token: "${SPLUNK_HEC_TOKEN}"
    verify_ssl: true

  # Elasticsearch/Kibana configuration
  elastic:
    enabled: true
    auto_deploy: false
    url: "https://elastic.example.com:9200"
    api_key: "${ELASTIC_API_KEY}"
    index_prefix: "rivendell-mitre"
    verify_ssl: true

  # ATT&CK Navigator configuration
  navigator:
    enabled: true
    # Layer metadata
    show_subtechniques: true
    gradient_colors:
      - "#e74c3c"  # Low (red)
      - "#f39c12"  # Medium (yellow/orange)
      - "#2ecc71"  # High (green)

# Integration with Elrond Analysis Pipeline
elrond_integration:
  enabled: true

  # Auto-map artifacts during analysis
  auto_map: true

  # Include MITRE mappings in analysis output
  include_in_output: true

  # Generate dashboards after analysis
  auto_generate_dashboards: true

  # Export formats for analysis output
  export_formats:
    - json
    - csv

  # MITRE fields to include in output
  output_fields:
    - technique_id
    - technique_name
    - tactics
    - confidence
    - evidence

# Custom Artifact Mappings
# Add your own artifact-to-technique mappings here
custom_mappings:
  # Example:
  # my_custom_artifact:
  #   - technique: "T1059"
  #     confidence: 0.85
  #   - technique: "T1106"
  #     confidence: 0.70

# Custom Context Rules
# Add pattern-based detection rules
custom_context_rules:
  # Example:
  # my_custom_rule:
  #   name: "Custom Malware Detection"
  #   patterns:
  #     - "mymalware"
  #     - "backdoor123"
  #   techniques:
  #     - technique: "T1059"
  #       confidence_bonus: 0.25

# Logging Configuration
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  file: "/var/log/rivendell/mitre.log"
  max_size_mb: 10
  backup_count: 5
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Performance Configuration
performance:
  # Number of parallel workers for processing
  max_workers: 4

  # Batch size for technique mapping
  batch_size: 100

  # Enable caching of technique lookups
  cache_lookups: true

  # Maximum memory usage (MB) before flushing cache
  max_memory_mb: 512

# Feature Flags
features:
  # Enable experimental features
  experimental: false

  # Enable beta features
  beta: false

  # Enable ML-based technique prediction (future)
  ml_prediction: false

# Notification Configuration
notifications:
  # Notify on ATT&CK framework updates
  on_update: true

  # Notification methods
  methods:
    email:
      enabled: false
      smtp_server: "smtp.example.com"
      smtp_port: 587
      from_address: "rivendell@example.com"
      to_addresses:
        - "analyst@example.com"

    webhook:
      enabled: false
      url: "https://hooks.example.com/rivendell"
      method: "POST"

    slack:
      enabled: false
      webhook_url: "${SLACK_WEBHOOK_URL}"

# API Configuration (for external integrations)
api:
  enabled: false
  host: "0.0.0.0"
  port: 8001
  auth_required: true
  api_key: "${RIVENDELL_API_KEY}"
  cors_enabled: true
  rate_limit:
    enabled: true
    requests_per_minute: 60

# Export Configuration
export:
  # Default export directory
  directory: "/tmp/rivendell/exports"

  # Available export formats
  formats:
    - json
    - csv
    - html
    - pdf

  # Include metadata in exports
  include_metadata: true

  # Compress exports
  compression: true

# Quality Assurance
qa:
  # Validate technique IDs against ATT&CK data
  validate_techniques: true

  # Warn on deprecated techniques
  warn_deprecated: true

  # Minimum confidence for auto-acceptance
  auto_accept_threshold: 0.9

# Development/Debug Settings
development:
  debug: false
  verbose: false
  dump_intermediate_results: false
  profiling: false
